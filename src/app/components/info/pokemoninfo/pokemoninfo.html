<div *ngIf="mensagemSemEvolucao" class="sem-evolucao-alert">
  <mat-icon class="alert-icon">close</mat-icon>
  {{ mensagemSemEvolucao }}
</div>

<div *ngIf="pokemonEditado && !errorMessage; else errorTemplate">
  <div 
    class="card-3d-wrapper" 
    [ngStyle]="{'transform': transformStyle}" 
    (mousemove)="onMouseMove($event, cardElement)" 
    (mouseleave)="onMouseLeave()"
    #cardElement>

    <button 
      class="btn-toggle-3d" 
      mat-icon-button 
      matTooltip="Ativar/desativar efeito 3D"
      (click)="ativar3D = !ativar3D">
      <mat-icon>{{ ativar3D ? 'close' : '360' }}</mat-icon>
    </button>

    <div class="pokemon-card-container">
      <mat-card [class]="'pokemon-card ' + (pokemonEditado.types?.[0]?.type?.name || 'normal')">
        <div class="card-header">
          <h1 class="pokemon-name" *ngIf="!modoEdicao">{{ pokemonEditado.name | titlecase }}</h1>

          <mat-form-field *ngIf="modoEdicao" class="edit-field full-width">
            <input matInput type="text" [(ngModel)]="pokemonEditado.name" required>
          </mat-form-field>

          <span class="pokemon-number">#{{ pokemonEditado.id | number:'3.0-0' }}</span>
        </div>

        <div class="image-section">
          <img class="main-image" 
               [src]="pokemonEditado.sprites?.other?.['official-artwork']?.front_default || 'assets/imagens/Erro.PNG'" 
               [alt]="pokemonEditado.name">

          <img class="shiny-image" 
               *ngIf="pokemonEditado.sprites?.other?.['official-artwork']?.front_shiny"
               [src]="pokemonEditado.sprites.other['official-artwork'].front_shiny" 
               [alt]="pokemonEditado.name + ' shiny'">
        </div>

        <mat-divider></mat-divider>

        <div class="info-section">
          <div class="info-row">
            <span class="info-label">Altura</span>
            <span *ngIf="!modoEdicao" class="info-value">{{ (pokemonEditado.height || 0) / 10 }} m</span>
            <mat-form-field *ngIf="modoEdicao" class="edit-field">
              <input matInput type="number" [(ngModel)]="pokemonEditado.height">
            </mat-form-field>
          </div>

          <div class="info-row">
            <span class="info-label">Peso</span>
            <span *ngIf="!modoEdicao" class="info-value">{{ (pokemonEditado.weight || 0) / 10 }} kg</span>
            <mat-form-field *ngIf="modoEdicao" class="edit-field">
              <input matInput type="number" [(ngModel)]="pokemonEditado.weight">
            </mat-form-field>
          </div>

          <div class="info-row">
            <span class="info-label">Tipos</span>
            <div class="types-container">
              <span *ngIf="pokemonEditado.types?.length"
                    class="tipo-badge {{ pokemonEditado.types[0]?.type?.name }}">
                {{ pokemonEditado.types[0]?.type?.name | titlecase }}
              </span>
            </div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="actions-section">
          <div class="left-button">
            <button mat-raised-button color="primary" (click)="voltarParaLista()" class="action-button">
              Voltar
            </button>
          </div>

          <div class="center-button">
            <button mat-icon-button color="accent" (click)="mostrarProximaEvolucao()"
                    matTooltip="Mostrar próxima evolução" class="candy-button">
              <img src="assets/icons/candy.svg" alt="Candy" class="candy-icon">
            </button>
          </div>

          <div class="right-buttons">
            <button *ngIf="!modoEdicao" mat-raised-button color="accent" (click)="entrarModoEdicao()" class="action-button edit-trigger">
              Editar
            </button>

            <div *ngIf="modoEdicao" class="edit-actions">
              <button mat-raised-button color="primary" (click)="salvarEdicoes()" class="action-button">
                Salvar
              </button>
              <button mat-raised-button color="warn" (click)="cancelarEdicao()" class="action-button">
                Cancelar
              </button>
            </div>
          </div>
        </div>
      </mat-card>
    </div>
  </div>
</div>

<!-- Removi a mensagem de evolução com animação -->



<ng-template #errorTemplate>
  <div class="error-container">
    <img src="assets/imagens/Erro.PNG" alt="Erro" class="error-image">
    <div class="error-message">
      <h2>Ocorreu um erro!</h2>
      <p>{{ errorMessage || 'Não foi possível carregar os dados do Pokémon' }}</p>
      <button mat-raised-button color="primary" routerLink="/">
        Voltar à lista
      </button>
    </div>
  </div>
</ng-template>
